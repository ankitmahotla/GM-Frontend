<!DOCTYPE html>
<html>
  <head>
    <title>Sapna Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              clifford: "#da373d",
            },
          },
        },
      };
    </script>
  </head>
  <body>
    <div class="max-w-md mx-auto">
      <h1 class="text-2xl font-semibold mb-6">Payment Details</h1>
      <form method="post" id="details">
        <div class="mb-4">
          <label for="name" class="block text-sm font-medium mb-2">
            Name
          </label>
          <input
            id="name"
            name="name"
            class="bg-white border border-[#d1d5db] text-[#111827] sm:text-sm rounded-lg block w-full p-2.5"
            placeholder="Enter Name"
            type="text"
          />
        </div>
        <div class="mb-4">
          <label for="email" class="block text-sm font-medium mb-2">
            Email
          </label>
          <input
            id="email"
            name="email"
            class="bg-white border border-[#d1d5db] text-[#111827] sm:text-sm rounded-lg block w-full p-2.5"
            placeholder="Enter Email"
            type="text"
          />
        </div>
        <div class="mb-4">
          <label for="phone" class="block text-sm font-medium mb-2">
            Phone
          </label>
          <div class="flex">
            <span
              class="inline-flex items-center px-3 text-sm text-gray-500 bg-gray-200 border border-r-0 border-[#d1d5db] rounded-l-md"
            >
              IND
            </span>
            <input
              id="phone"
              name="phone"
              class="bg-white border border-[#d1d5db] text-[#111827] sm:text-sm rounded-none rounded-r-lg block w-full p-2.5"
              placeholder="Enter Phone"
              type="text"
            />
          </div>
        </div>
        <div class="mb-4">
          <label for="gender" class="block text-sm font-medium mb-2">
            Gender
          </label>
          <select
            class="bg-white border border-[#d1d5db] text-[#111827] sm:text-sm rounded-none rounded-r-lg block w-full p-2.5"
            name="gender"
            id="gender"
          >
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>
        </div>
        <div class="mb-4">
          <label for="email" class="block text-sm font-medium mb-2">
            Date of Birth
          </label>
          <input
            id="birthday"
            name="birthday"
            class="bg-white border border-[#d1d5db] text-[#111827] sm:text-sm rounded-lg block w-full p-2.5"
            type="date"
          />
        </div>
        <div class="mb-4">
          <div class="flex justify-between mb-2">
            <span class="text-sm font-medium">Original Price</span>
            <span class="text-sm">₹199.00</span>
          </div>
          <hr />
          <div class="flex justify-between mt-2">
            <span class="text-sm font-semibold">Total</span>
            <span class="text-sm font-semibold">₹199.00</span>
          </div>
        </div>
        <button
          type="submit"
          id="payment"
          class="w-full bg-black text-white rounded-lg px-4 py-2.5 hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-50 cursor:pointer"
        >
          Pay ₹199.00
        </button>
      </form>
    </div>
    <script>
      const form = document.getElementById("details");
      const paymentButton = document.getElementById("payment");
      paymentButton.onclick = async function (e) {
        e.preventDefault();
        const urlParams = new URLSearchParams(window.location.search);

        const formData = {
          name: form.name.value.trim(),
          email: form.email.value.trim(),
          phone: form.phone.value.trim(),
          gender: form.gender.value,
          birthday: form.birthday.value,
        };

        const getInput = (name) => {
          return document.getElementById(name);
        };

        const setBorder = (input, value) => {
          input.style.border = value;
          input.onchange = function () {
            input.style.border = "";
          };
        };

        for (const [key, value] of Object.entries(formData)) {
          const input = getInput(key);
          if (value === "") {
            setBorder(input, "1px solid red");
            return;
          }
        }
        paymentButton.disabled = true;
        const data = {
          name: formData.name,
          email: formData.email,
          phone: formData.phone,
          gender: formData.gender,
          birthday: formData.birthday,
          utm_source: urlParams.get("utm_source"),
          utm_medium: urlParams.get("utm_medium"),
          utm_campaign: urlParams.get("utm_campaign"),
          utm_adgroup: urlParams.get("utm_adgroup"),
          utm_content: urlParams.get("utm_content"),
          utm_term: urlParams.get("utm_term"),
          utm_id: urlParams.get("utm_id"),
          adsetname: urlParams.get("adset name"),
          adname: urlParams.get("ad name"),
          landingPageSource: window.location.href,
        };
        console.log(
          "User details and utm params stored in data variable at: ",
          new Date()
        );

        try {
          const response = await fetch(
            "https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjUwNTZhMDYzNDA0MzI1MjY1NTUzMzUxMzMi_pc",
            {
              method: "POST",
              body: JSON.stringify(data),
            }
          );
          console.log(
            "Sent request to webhook for posting data at: ",
            new Date()
          );
          console.log("Response status:", response);
          console.log("Response text:", await response.text());
          window.location.href = `https://pages.razorpay.com/pl_O5Xf3LtT0Orjcx/view?full_name_you_are_using=${formData.name}&email=${formData.email}&phone=${formData.phone}&gender=${formData.gender}&select=Numerology%20Report&date_of_birth=${formData.birthday}`;
        } catch (error) {
          console.log(error);
        }
      };
    </script>
  </body>
</html>
