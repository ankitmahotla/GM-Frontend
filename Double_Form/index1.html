<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            clifford: "#da373d",
          },
        },
      },
    };
  </script>
</head>

<body>
  <div class="max-w-md mx-auto">
    <form method="post" id="details1">
      <h1 class="text-2xl font-semibold mb-6">Payment Details</h1>
      <div class="mb-4">
        <label for="name" class="block text-sm font-medium mb-2">
          Name
        </label>
        <input id="name" name="name"
          class="bg-white border border-[#d1d5db] text-[#111827] sm:text-sm rounded-lg block w-full p-2.5"
          placeholder="Enter Name" type="text" />
        <p id="nameError" class="hidden text-red-500 text-xs m-1">
          Please enter your name.
        </p>
      </div>
      <div class="mb-4">
        <label for="email" class="block text-sm font-medium mb-2">
          Email
        </label>
        <input id="email" name="email"
          class="bg-white border border-[#d1d5db] text-[#111827] sm:text-sm rounded-lg block w-full p-2.5"
          placeholder="Enter Email" type="text" />
        <p id="emailError" class="hidden text-red-500 text-xs m-1">
          Please enter a valid email address.
        </p>
      </div>
      <div class="mb-4">
        <label for="phone" class="block text-sm font-medium mb-2">
          Phone
        </label>
        <div class="flex">
          <span
            class="inline-flex items-center px-3 text-sm text-gray-500 bg-gray-200 border border-r-0 border-[#d1d5db] rounded-l-md">
            IND
          </span>
          <input id="phone" name="phone"
            class="bg-white border border-[#d1d5db] text-[#111827] sm:text-sm rounded-none rounded-r-lg block w-full p-2.5"
            placeholder="Enter Phone" type="text" />
        </div>
        <p id="phoneError" class="hidden text-red-500 text-xs m-1">
          Please enter valid 10 digit phone number.
        </p>
      </div>
      <div class="mb-4">
        <div class="flex justify-between mb-2">
          <span class="text-sm font-medium">Original Price</span>
          <span class="text-sm amount1">₹197.00</span>
        </div>
        <hr />
        <div class="flex justify-between mt-2">
          <span class="text-sm font-semibold">Total</span>
          <span class="text-sm font-semibold total-amount1">₹232.46</span>
        </div>
      </div>
      <button type="submit" id="payment1"
        class="w-full bg-black text-white rounded-lg px-4 py-2.5 hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-50 cursor:pointer">
        Pay ₹232.46
      </button>
    </form>
  </div>

  <script>
    const clientName = "SALMANKHAN";

    const amount1 = "9";
    const purpose1 = "2 Days live workshop";
    const redirectUrl1 = "https://webinar.ravirkumar.com/2days-ws-ty";
    const userDetailWebhook1 =
      "https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjUwNTZhMDYzMjA0MzY1MjY1NTUzNTUxMzUi_pc";
    const paymentDetailWebhook1 =
      "https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjUwNTZhMDYzMjA0MzY1MjY1NTUzNjUxMzEi_pc";
    const checkPaymentWebhook1 =
      "https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjUwNTZhMDYzMjA0MzY1MjY1NTUzNjUxMzQi_pc";

    const baseUrl = "https://growthifymedia-services.onrender.com";

    const form1 = document.getElementById("details1");
    const paymentButton1 = document.getElementById("payment1");

    document.getElementsByClassName("amount1")[0].innerText = `₹${amount1}.00`;
    document.getElementsByClassName("total-amount1")[0].innerText = `₹${amount1}.00`;
    paymentButton1.innerText = `Pay ₹${amount1}.00`;

    const getInput = (name) => {
      return document.getElementById(name);
    };

    const setBorder = (input, value) => {
      input.style.border = value;
    };

    const isValidName = (name) => {
      // Check if the name is not empty
      if (!name.trim()) {
        return false;
      }

      // Check if the name contains only letters (no numbers or special characters)
      const nameRegex = /^[a-zA-Z\s]+$/;
      return nameRegex.test(name.trim());
    };

    const isValidEmail = (email) => {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    };

    const isValidPhone = (phone) => {
      const phoneRegex = /^[5-9][0-9]{9}$/;
      const sequentialPattern = /(.)\1{9}/; // Check for 10 repeated digits
      const sequentialMatch = phone.match(sequentialPattern);
      return phoneRegex.test(phone) && !sequentialMatch;
    };

    paymentButton1.addEventListener("click", async (e) => {
      e.preventDefault();

      const formData = {
        name: form1.name.value.trim(),
        email: form1.email.value.trim(),
        phone: form1.phone.value.trim(),
      };

      let isValid = true;

      if (!isValidName(formData.name)) {
        const nameError = getInput("nameError");
        nameError.style.display = "flex";
        const input = getInput("name");
        input.oninput = function () {
          nameError.style.display = "none";
          setBorder(input, "");
        };
        setBorder(input, "1px solid red");
        isValid = false;
      }

      if (!isValidEmail(formData.email)) {
        const emailError = getInput("emailError");
        emailError.style.display = "flex";
        const input = getInput("email");
        input.oninput = function () {
          emailError.style.display = "none";
          setBorder(input, "");
        };
        setBorder(input, "1px solid red");
        isValid = false;
      }

      if (!isValidPhone(formData.phone)) {
        const phoneError = getInput("phoneError");
        phoneError.style.display = "flex";
        const input = getInput("phone");
        input.oninput = function () {
          phoneError.style.display = "none";
          setBorder(input, "");
        };
        setBorder(input, "1px solid red");
        isValid = false;
      }

      if (isValid) {
        paymentButton1.disabled = true;
        paymentButton1.style.opacity = 0.7;
        paymentButton1.innerText = "Submitting...";
        const urlParams = new URLSearchParams(window.location.search);
        const data = {
          name: formData.name,
          amount: amount1,
          email: formData.email,
          phone: formData.phone,
          purpose: purpose1,
          redirectUrl: redirectUrl1,
          utm_source: urlParams.get("utm_source"),
          utm_medium: urlParams.get("utm_medium"),
          utm_campaign: urlParams.get("utm_campaign"),
          utm_adgroup: urlParams.get("utm_adgroup"),
          utm_content: urlParams.get("utm_content"),
          utm_term: urlParams.get("utm_term"),
          utm_id: urlParams.get("utm_id"),
          adsetname: urlParams.get("adset name"),
          adname: urlParams.get("ad name"),
          landingPageUrl: window.location.href.split('?')[0],
        };

        const updatedData = {
          formData: data,
          userDetailWebhook: userDetailWebhook1,
          paymentDetailWebhook: paymentDetailWebhook1,
          checkPaymentWebhook: checkPaymentWebhook1,
        };
        try {
          const response = await fetch(
            `${baseUrl}/api/payments/new/instamojo/createPayment/${clientName}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(updatedData),
            }
          );
          const jsonData = await response.json();
          console.log(jsonData);
          paymentButton1.style.opacity = 1;
          paymentButton1.innerText = `Pay ₹${amount1}`;
          paymentButton1.disabled = false;
          window.location.href = jsonData.data;
        } catch (error) {
          alert("Some error occured! Please retry");
          console.log(error);
        }
      }
    });
  </script>
</body>

</html>